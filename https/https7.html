<!DOCTYPE html>
<html lang="en">

<head>
    <title>Ryu의 코딩 블로그</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="../css/animate.css">

    <link rel="stylesheet" href="../css/owl.carousel.min.css">
    <link rel="stylesheet" href="../css/owl.theme.default.min.css">
    <link rel="stylesheet" href="../css/magnific-popup.css">

    <link rel="stylesheet" href="../css/aos.css">

    <link rel="stylesheet" href="../css/ionicons.min.css">

    <link rel="stylesheet" href="../css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="../css/jquery.timepicker.css">


    <link rel="stylesheet" href="../css/flaticon.css">
    <link rel="stylesheet" href="../css/icomoon.css">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>

    <div id="colorlib-page">
        <a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle"><i></i></a>
        <aside id="colorlib-aside" role="complementary" class="js-fullheight">
            <nav id="colorlib-main-menu" role="navigation">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../javascriptindex.html">JavaScript</a></li>
                    <li><a href="../linuxindex.html">Linux</a></li>
                    <li><a href="../nodeindex.html">Node.js</a></li>
                    <li><a href="../algorithmindex.html">알고리즘</a></li>
                    <li><a href="../databaseindex.html">Database</a></li>
                    <li><a href="../mvcindex.html">MVC</a></li>
                    <li><a href="../sequelizeindex.html">Sequelize</a></li>
                    <li class="colorlib-active"><a href="../cookiesession.html">인증/보안</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
            </nav>

            <div class="colorlib-footer">
                <h1 id="colorlib-logo" class="mb-4"><a href="../index.html"
                        style="background-image: url(../images/bg_1.jpg);">Ryu <span>coding</span></br></a></h1>

                <p class="pfooter">
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    Copyright &copy;
                    <script>document.write(new Date().getFullYear());</script> All rights reserved by Ryu coding and
                    This template is copyrighted by Colorlib</a>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </p>
            </div>
        </aside> <!-- END COLORLIB-ASIDE -->
        <div id="colorlib-main">
            <section class="ftco-section ftco-no-pt ftco-no-pb">
                <div class="container">
                    <div class="row d-flex">
                        <div class="col-lg-8 px-md-5 py-5">

                            <h1>토큰기반 인증</h1>

                            <div class="row pt-md-4">

                                <h2 class="mb-3">1. 토큰기반 인증</h2>

                                <p>세션 기반 인증은 서버 또는 DB에 유저 정보를 담는 인증 방식으로 매 요청마다 데이터베이스를 살펴보는 것이 부담되었다.<br>
                                    이 부담을 덜어주기 위해 클라이언트에서 인증 정보를 보관하는 방법으로 토큰 기반 인증 방식이 고안되었다.
                                </p>

                                <p>클라이언트가 토큰을 가지고 있다면 서버에서 제공하는 다양한 기능을 요청할 수 있으며 토큰은 정보를 암호화한 상태로 담을 수 있고 암호화했기 때문에 클라이언트에 담을 수 있다.</p>

                                <h3 class="mb-3">토큰기반 인증의 장점</h3>

                                <p>토큰기반 인증의 장점으로는 다음과 같은 장점이 있다.</p>

                                <h4 class="mb-3">Statelessness(무상태성) & Scalability(확장성)</h4>

                                <p>서버는 클라이언트에 대한 정보를 저장할 필요가 없고 토큰 해독이 되는지만 판단하면 된다.</p>

                                <p>클라이언트는 새로운 요청을 보낼 때마다 토큰을 헤더에 포함시키 인증절차를 완료한다.<br>
                                    만약 서버를 여러 개 가지고 있으면 같은 토큰으로 여러 서버에서 인증이 가능하므로 확장성이 있다.
                                </p>

                                <h4 class="mb-3">안정성</h4>

                                <p>암호화된 토큰을 사용하고 암호화 키를 노출할 필요가 없기 때문에 안전하다.</p>
                               
                                <h4 class="mb-3">어디서나 생성 가능</h4>

                                <p>토큰을 확인하는 서버가 토큰을 생성하지 않아도 된다.<br>
                                    즉, 토큰 생성용 서버를 따로 만들거나 다른 회사에서 토큰 관련 작업을 맡기는 것 등 다양한 활용이 가능하다.
                                </p>
                                
                                <h4 class="mb-3">권한 부여에 용이</h4>

                                <p>토큰의 payload 안에 어떤 정보에 접근 가능한지 정의할 수 있다.</p>

                                <h2 class="mb-3">2. JWT</h2>

                                <p>JWT는 JSON Web Token의 약자로 JSON 포맷으로 사용자에 대한 속성을 저장하는 웹 토큰이다.</p>

                                <h3 class="mb-3">JWT 종류</h3>

                                <p>JWT의 종류로 Access Token과 Refresh Token이 있다.</p>

                                <p>Access token은 보호된 정보들에 접근할 수 있는 권한부여에 사용한다.<br>
                                    클라이언트가 처음 인증을 받게 될 때 Access, Refresh Token 두 가지를 다 받을 수 있지만 실제로 권한을 얻는 데 사용하는 토큰은 Access Token이다.
                                </p>

                                <p>Access Token에는 비교적 짧은 유효 기간을 주어 탈취되더라도 오랫동안 사용할 수 없도록 하는 것이 좋다.<br>
                                    Access Token의 유효기간이 만료된다면 Refresh Token을 사용하여 새로운 Access Token을 발급받는다.<br>
                                    하지만 Refresh Token의 편의보다 정보를 지키는 것이 더 중요한 웹사이트들은 Refresh Token을 사용하지 않는 곳도 있다.
                                </p>

                                <h3 class="mb-3">JWT 구조</h3>

                                <p>JWT는 아래 사진과 같이 "."으로 나누어진 Header, Payload, Signature 3부분이 존재한다.</p>

                                <p>
									<img src="../images/jwt.PNG" alt="" class="img-fluid">
								</p>

                                <h4 class="mb-3">Header</h4>

                                <p>Header는 어떤 종류의 토큰인지 어떤 알고리즘으로 암호화할지가 JSON 형태로 적혀있으며 이 JSON 객체를 base64 방식으로 인코딩하면 JWT의 Header 부분이 완성된다.</p>

                                <h4 class="mb-3">Payload</h4>

                                <p>Payload에는 정보와 어떤 정보에 접근 가능한지에 대한 권한을 담을 수 있다.<br>
                                    이렇게 Payload에 담은 데이터를 암호화 시킨다.
                                </p>

                                <p>Payload 또한 Header와 같이 base64 방식으로 인코딩하여 완성한다.</p>

                                <p>Payload 에는 민감한 정보는 되도록 담지 않는 것이 좋다.</p>

                                <h4 class="mb-3">Signature</h4>

                                <p>Header, Payload가 base64로 완성되었다면 원하는 비밀 키(암호화에 추가할 Salt 값)를 사용하여 암호화한다.</p>

                                <h2 class="mb-3">3. JWT 사용방법</h2>

                                <p>JWT의 설치방법과 JWT의 생성 및 verify(해독, 검증)하는 방법에 대한 설명</p>

                                <h3 class="mb-3">JWT 라이브러리 설치</h3>

                                <code>
                                    npm install jsonwebtoken
                                </code>

                                <h3 class="mb-3">jwt.sign()</h3>

                                <p>jwt.sign() 메서드는 JWT을 생성하는 메서드로 동기식일 때 JWT를 문자열로 반환한다.<br>
                                    비동기식일 때 callback이 제공된 경우 error 또는 JWT와 함께 callback이 호출된다.
                                </p>

                                <h4 class="mb-3">문법</h4>
                                
                                <code>
                                    jwt.sign(&lt;payload&gt;, &lt;secret_or_privateKey&gt;, {&lt;option&gt;}, &lt;callback&gt;)
                                </code>

                                <p>payload : 정보와 어떤 정보에 접근 가능한지에 대한 권한을 담은 JSON 객체<br>
                                    secretOrPrivateKey : 문자열의 비밀키 또는 PrivateKey<br>
                                    option.algorithm : default는 HS256로 가장 많이 사용하기 때문에 따로 입력하지 않고 default 값을 많이 사용한다.<br>
                                    option.expiresIn : 토큰 만료일을 설정하는 밀리초 또는 문자열로 숫자 값은 밀리초로 문자열일 경우 days, h, d 와 같이 날짜와 시간을 제공해야한다.
                                </p>

                                <h4 class="mb-3">예시</h4>

                                <h5 class="mb-3">동기식</h5>

                                <code>
                                    const jwt = require("jsonwebtoken");<br>
                                    const token = jwt.sign(&lt;payload&gt;, &lt;secret_or_privateKey&gt;, {expiresIn: "1d"});
                                </code>

                                <h5 class="mb-3">비동기식</h5>

                                <code>
                                    const jwt = require("jsonwebtoken");<br>
                                    jwt.sign(&lt;payload&gt;, &lt;secret_or_privateKey&gt;, {expiresIn: "1d"}, function(err, token){<br>
                                    &nbsp;&nbsp;console.log(token);<br>
                                    });
                                </code>

                                <h3 class="mb-3">jwt.verify()</h3>

                                <p>jwt.verify() 메서드는 JWT를 verify(해독, 검증)하는 메서드로 callback이 제공된 경우 비동기적으로 작동하고 JWT가 유효하면 디코딩된 payload와 함께 callback이 호출된다.<br>
                                    callback이 제공되지 않으면 동기식으로 작동하고 JWT가 유효하면 디코딩된 payload를 반환한다.<br>
                                    JWT가 유효하지 않다면 비동기식은 error가 호출되고 동기식은 error가 발생한다.
                                </p>

                                <p>jwt.verify() 메서드 사용시 JWT을 매개변수로 받아야하기 때문에 JWT를 따로 구해야한다.<br>
                                    JWT를 Cookie로 전달하면 Cookie는 응답 헤더에 심어서 전송한다는 걸 생각하자
                                </p>

                                <h4 class="mb-3">문법</h4>

                                <code>
                                    jwt.verify(&lt;token&gt;, &lt;secret_or_publicKey&gt;, {&lt;option&gt;}, &lt;callback&gt;)
                                </code>

                                <p>token : 문자열의 JWT<br>
                                    secretOrPublicKey : 문자열의 비밀키 또는 PublicKey
                                </p>

                                <h4 class="mb-3">예시</h4>

                                <h5 class="mb-3">동기식</h5>

                                <code>
                                    const jwt = require("jsonwebtoken");<br>
                                    const decoded = jwt.verify(&lt;token&gt;, &lt;secret_or_publicKey&gt;);
                                </code>

                                <h5 class="mb-3">비동기식</h5>

                                <code>
                                    jwt.verify(&lt;token&gt;, &lt;secret_or_publicKey&gt;, function(err, decoded){<br>
                                    &nbsp;&nbsp;console.log(decoded);<br>
                                    });
                                </code>

                                <h5 class="mb-3">유효하지 않은 토큰(동기식)</h5>

                                <code>
                                    try{<br>
                                    &nbsp;&nbsp;const decoded = jwt.verify(&lt;token&gt;, &lt;secret_or_publicKey&gt;);<br>
                                    }catch(err){<br>
                                    &nbsp;&nbsp;// err<br>
                                    }
                                </code>

                                <h5 class="mb-3">유효하지 않은 토큰(비동기식)</h5>

                                <code>
                                    jwt.verify(&lt;token&gt;, &lt;secret_or_publicKey&gt;, function(err, decoded){<br>
                                    &nbsp;&nbsp;// err<br>
                                    &nbsp;&nbsp;// decoded undefined<br>
                                    });
                                </code>
                                
                                <h2 class="mb-3">4. 공식 문서</h2>

                                <p>추가적인 내용이나 위의 내용들을 더 자세히 보고 싶으면 jsonwebtoken 공식 문서를 확인해보자</p>

                                <p>
                                    <a href="https://github.com/auth0/node-jsonwebtoken" target="_blank">jsonwebtoken 공식 문서</a> 
                                </p>

                            </div>
                        </div>

                        <div class="col-lg-4 sidebar ftco-animate bg-light pt-5">
                            <div class="sidebar-box ftco-animate">

                                <h3 class="sidebar-heading">List</h3>

                                <ol>
                                    <li>토큰기반 인증
                                        <ul>
                                            <li>토큰기반 인증의 장점</li>
                                        </ul>
                                    </li>
                                    <li>JWT
                                        <ul>
                                            <li>JWT 종류</li>
                                            <li>JWT 구조</li>
                                        </ul>
                                    </li>
                                    <li>JWT 사용방법
                                        <ul>
                                            <li>JWT 라이브러리 설치</li>
                                            <li>jwt.sign()</li>
                                            <li>jwt.verify()</li>
                                        </ul>
                                    </li>
                                    <li>공식 문서</li>
                                </ol>

                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </div><!-- END COLORLIB-MAIN -->
    </div><!-- END COLORLIB-PAGE -->

    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00" />
        </svg></div>


    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery-migrate-3.0.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jquery.easing.1.3.js"></script>
    <script src="../js/jquery.waypoints.min.js"></script>
    <script src="../js/jquery.stellar.min.js"></script>
    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/jquery.magnific-popup.min.js"></script>
    <script src="../js/aos.js"></script>
    <script src="../js/jquery.animateNumber.min.js"></script>
    <script src="../js/scrollax.min.js"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="../js/google-map.js"></script>
    <script src="../js/main.js"></script>

</body>

</html>